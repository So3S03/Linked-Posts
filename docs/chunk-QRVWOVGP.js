import{e as E,g as M,k as L}from"./chunk-RLNWFT3D.js";import{Ga as f,Ja as l,V as c,Wb as k,Xa as _,Y as b,Za as P,ab as C,d as W,e as g,eb as n,fb as o,fc as R,ga as d,gb as x,ha as h,hb as y,hc as T,ib as m,jb as p,lc as V,pb as s,rc as A,sb as v,tb as S,ub as w,uc as N,vb as I,wb as D,yb as F,zb as U}from"./chunk-KODTIHXY.js";var u=W(N());function j(a,z){if(a&1){let t=y();n(0,"div",1),x(1,"img",4),o(),n(2,"button",5),m("click",function(){d(t);let e=p();return h(e.deletePhoto())}),s(3,"Delete Photo"),o(),n(4,"p",6)(5,"span",7),s(6,"*"),o(),s(7,"Note: that I have tried to delete photo from the original post but the problem came from back-end (after saving the photo from the first time it can't be deleted from database)"),o(),n(8,"div")(9,"p",8),s(10),F(11,"date"),o()(),n(12,"div",9)(13,"button",10),m("click",function(){d(t);let e=p();return h(e.updatePostData())}),s(14,"Save Changes"),o(),n(15,"button",11),m("click",function(){d(t);let e=p();return h(e.goHome())}),s(16,"Cancel"),o()()}if(a&2){let t=p();l(),P("src",t.imagePath,f),l(9),v("this post created at ",U(11,3,t.post.createdAt)," by ",t.post.user.name,"")}}var X=(()=>{class a{constructor(){this._ActivatedRoute=c(E),this._PostService=c(L),this._Router=c(M)}ngOnInit(){this._ActivatedRoute.params.subscribe(t=>this.postId=t.id),this.PostServSubscribtion=this._PostService.getSinglePost(this.postId).subscribe({next:t=>{this.post=t.post,this.imagePath=t.post.image,this.postContent=t.post.body,this.imagePath&&g(this,null,function*(){let e=yield(yield fetch(this.imagePath)).blob();this.imageFile=new File([e],this.imagePath,{type:e.type})})},error:t=>{console.log(t)}})}holdImage(t){this.imageInput=t.target,this.imageInput.files&&this.imageInput.files.length>0&&(this.imageFile=this.imageInput.files[0],this.imagePath=URL.createObjectURL(this.imageFile))}deletePhoto(){this.imageFile=null,this.imagePath=""}updatePostData(){let t=new FormData;this.postContent&&t.append("body",this.postContent),this.imageFile&&t.append("image",this.imageFile),(t.has("body")||t.has("image"))&&this._PostService.updatePost(this.postId,t).subscribe({next:i=>{u.default.fire({title:"Done!",text:"Your post has been updated successfuly!",icon:"success"}),this._Router.navigate(["/PostDetailes",this.postId])},error:i=>{console.log(i),u.default.fire({icon:"error",title:"Oops...",text:"Something went wrong!"})}})}goHome(){this._Router.navigate(["/TimeLine"])}ngOnDestroy(){this.PostServSubscribtion.unsubscribe(),this.imagePath="",this.imageFile=null,this.postContent=""}static{this.\u0275fac=function(i){return new(i||a)}}static{this.\u0275cmp=b({type:a,selectors:[["app-update-post"]],standalone:!0,features:[D],decls:6,vars:2,consts:[[1,"col-lg-5","mx-auto","custom-margin-top"],[1,"mb-3"],["placeholder","Write your thoughts here...","rows","3",1,"form-control","border-dashed","bg-secondary-subtle","border-secondary",3,"ngModelChange","ngModel"],["type","file","placeholder","Choose Photo",1,"form-control","border-dashed","bg-secondary-subtle","border-secondary",3,"change"],["alt","",1,"w-100",3,"src"],[1,"btn","btn-danger","w-100","mt-5",3,"click"],[1,"fs-small","mb-5"],[1,"text-danger"],[1,"text-capitalize"],[1,"my-4","text-end"],[1,"btn","btn-primary","me-2",3,"click"],[1,"btn","btn-outline-secondary",3,"click"]],template:function(i,e){i&1&&(n(0,"section",0)(1,"div",1)(2,"textarea",2),I("ngModelChange",function(r){return w(e.postContent,r)||(e.postContent=r),r}),o()(),n(3,"div",1)(4,"input",3),m("change",function(r){return e.holdImage(r)}),o()(),_(5,j,17,5),o()),i&2&&(l(2),S("ngModel",e.postContent),l(3),C(5,e.imagePath?5:-1))},dependencies:[A,R,T,V,k]})}}return a})();export{X as UpdatePostComponent};
